// Generated by: hibernate/SpringHibernateDaoImpl.vsl in andromda-spring-cartridge.
/**
 * This is only generated once! It will never be overwritten.
 * You can (and have to!) safely modify it by hand.
 */
package org.phoenixctms.ctsms.domain;

import java.util.Collection;

import org.hibernate.criterion.Projections;
import org.hibernate.criterion.Restrictions;
import org.phoenixctms.ctsms.enumeration.ECRFValidationStatus;
import org.phoenixctms.ctsms.query.CriteriaUtil;
import org.phoenixctms.ctsms.query.SubCriteriaMap;
import org.phoenixctms.ctsms.util.L10nUtil;
import org.phoenixctms.ctsms.util.L10nUtil.Locales;
import org.phoenixctms.ctsms.vo.ECRFOutVO;
import org.phoenixctms.ctsms.vo.ECRFStatusEntryVO;
import org.phoenixctms.ctsms.vo.ECRFStatusTypeVO;
import org.phoenixctms.ctsms.vo.PSFVO;
import org.phoenixctms.ctsms.vo.ProbandListEntryOutVO;
import org.phoenixctms.ctsms.vo.UserOutVO;
import org.phoenixctms.ctsms.vo.VisitOutVO;

/**
 * @see ECRFStatusEntry
 */
public class ECRFStatusEntryDaoImpl
		extends ECRFStatusEntryDaoBase {

	private org.hibernate.Criteria createEcrfStatusEntryCriteria() {
		org.hibernate.Criteria ecrfStatusEntryCriteria = this.getSession().createCriteria(ECRFStatusEntry.class);
		return ecrfStatusEntryCriteria;
	}

	@Override
	public ECRFStatusEntry eCRFStatusEntryVOToEntity(ECRFStatusEntryVO eCRFStatusEntryVO) {
		ECRFStatusEntry entity = this.loadECRFStatusEntryFromECRFStatusEntryVO(eCRFStatusEntryVO);
		this.eCRFStatusEntryVOToEntity(eCRFStatusEntryVO, entity, true);
		return entity;
	}

	@Override
	public void eCRFStatusEntryVOToEntity(
			ECRFStatusEntryVO source,
			ECRFStatusEntry target,
			boolean copyIfNull) {
		super.eCRFStatusEntryVOToEntity(source, target, copyIfNull);
		ECRFStatusTypeVO statusVO = source.getStatus();
		ECRFOutVO ecrfVO = source.getEcrf();
		ProbandListEntryOutVO listEntryVO = source.getListEntry();
		VisitOutVO visitVO = source.getVisit();
		UserOutVO modifiedUserVO = source.getModifiedUser();
		if (statusVO != null) {
			target.setStatus(this.getECRFStatusTypeDao().eCRFStatusTypeVOToEntity(statusVO));
		} else if (copyIfNull) {
			target.setStatus(null);
		}
		if (ecrfVO != null) {
			ECRF ecrf = this.getECRFDao().eCRFOutVOToEntity(ecrfVO);
			target.setEcrf(ecrf);
			ecrf.addEcrfStatusEntries(target);
		} else if (copyIfNull) {
			ECRF ecrf = target.getEcrf();
			target.setEcrf(null);
			if (ecrf != null) {
				ecrf.removeEcrfStatusEntries(target);
			}
		}
		if (listEntryVO != null) {
			ProbandListEntry listEntry = this.getProbandListEntryDao().probandListEntryOutVOToEntity(listEntryVO);
			target.setListEntry(listEntry);
			listEntry.addEcrfStatusEntries(target);
		} else if (copyIfNull) {
			ProbandListEntry listEntry = target.getListEntry();
			target.setListEntry(null);
			if (listEntry != null) {
				listEntry.removeEcrfStatusEntries(target);
			}
		}
		if (visitVO != null) {
			Visit visit = this.getVisitDao().visitOutVOToEntity(visitVO);
			target.setVisit(visit);
			visit.addEcrfStatusEntries(target);
		} else if (copyIfNull) {
			Visit visit = target.getVisit();
			target.setVisit(null);
			if (visit != null) {
				visit.removeEcrfStatusEntries(target);
			}
		}
		if (modifiedUserVO != null) {
			target.setModifiedUser(this.getUserDao().userOutVOToEntity(modifiedUserVO));
		} else if (copyIfNull) {
			target.setModifiedUser(null);
		}
	}

	@Override
	protected ECRFStatusEntry handleFindByListEntryEcrfVisit(Long probandListEntryId, Long ecrfId, Long visitId) throws Exception {
		org.hibernate.Criteria ecrfStatusEntryCriteria = createEcrfStatusEntryCriteria();
		ecrfStatusEntryCriteria.add(Restrictions.eq("ecrf.id", ecrfId.longValue()));
		if (visitId != null) {
			ecrfStatusEntryCriteria.add(Restrictions.eq("visit.id", visitId.longValue()));
		} else {
			ecrfStatusEntryCriteria.add(Restrictions.isNull("visit.id"));
		}
		ecrfStatusEntryCriteria.add(Restrictions.eq("listEntry.id", probandListEntryId.longValue()));
		ecrfStatusEntryCriteria.setMaxResults(1);
		return (ECRFStatusEntry) ecrfStatusEntryCriteria.uniqueResult();
	}

	@Override
	protected Collection<ECRFStatusEntry> handleFindByTrialListEntryDoneValidatedReviewVerified(Long trialId, Long probandListEntryId, Boolean done,
			Boolean validated, Boolean review, Boolean verified, PSFVO psf) throws Exception {
		org.hibernate.Criteria ecrfStatusEntryCriteria = createEcrfStatusEntryCriteria();
		SubCriteriaMap criteriaMap = new SubCriteriaMap(ECRFStatusEntry.class, ecrfStatusEntryCriteria);
		if (trialId != null) {
			org.hibernate.Criteria trialCriteria = ecrfStatusEntryCriteria.createCriteria("listEntry");
			trialCriteria.add(Restrictions.eq("trial.id", trialId.longValue()));
		}
		if (probandListEntryId != null) {
			ecrfStatusEntryCriteria.add(Restrictions.eq("listEntry.id", probandListEntryId.longValue()));
		}
		applyEcrfStatusTypeCriterions(ecrfStatusEntryCriteria, null, null, done, validated, review, verified);
		CriteriaUtil.applyPSFVO(criteriaMap, psf);
		return ecrfStatusEntryCriteria.list();
	}

	@Override
	protected Collection<ECRFStatusEntry> handleFindByTrialListEntryEcrfVisitValidationStatus(Long trialId, Long probandListEntryId, Long ecrfId, Long visitId,
			ECRFValidationStatus validationStatus, PSFVO psf) throws Exception {
		org.hibernate.Criteria ecrfStatusEntryCriteria = createEcrfStatusEntryCriteria();
		SubCriteriaMap criteriaMap = new SubCriteriaMap(ECRFStatusEntry.class, ecrfStatusEntryCriteria);
		if (trialId != null) {
			org.hibernate.Criteria trialCriteria = ecrfStatusEntryCriteria.createCriteria("listEntry");
			trialCriteria.add(Restrictions.eq("trial.id", trialId.longValue()));
		}
		if (probandListEntryId != null) {
			ecrfStatusEntryCriteria.add(Restrictions.eq("listEntry.id", probandListEntryId.longValue()));
		}
		if (ecrfId != null) {
			ecrfStatusEntryCriteria.add(Restrictions.eq("ecrf.id", ecrfId.longValue()));
			if (visitId != null) {
				ecrfStatusEntryCriteria.add(Restrictions.eq("visit.id", visitId.longValue()));
			} else {
				ecrfStatusEntryCriteria.add(Restrictions.isNull("visit.id"));
			}
		}
		if (validationStatus != null) {
			ecrfStatusEntryCriteria.add(Restrictions.eq("validationStatus", validationStatus));
		}
		CriteriaUtil.applyPSFVO(criteriaMap, psf);
		return ecrfStatusEntryCriteria.list();
	}

	@Override
	protected long handleGetCount(Long probandListEntryId, Long ecrfId, Long visitId, Long ecrfStatusTypeId, Boolean valueLockdown, Boolean done, Boolean validated,
			Boolean review, Boolean verified)
			throws Exception {
		org.hibernate.Criteria ecrfStatusEntryCriteria = createEcrfStatusEntryCriteria();
		if (probandListEntryId != null) {
			ecrfStatusEntryCriteria.add(Restrictions.eq("listEntry.id", probandListEntryId.longValue()));
		}
		if (ecrfId != null) {
			ecrfStatusEntryCriteria.add(Restrictions.eq("ecrf.id", ecrfId.longValue()));
			if (visitId != null) {
				ecrfStatusEntryCriteria.add(Restrictions.eq("visit.id", visitId.longValue()));
			} else {
				ecrfStatusEntryCriteria.add(Restrictions.isNull("visit.id"));
			}
		}
		applyEcrfStatusTypeCriterions(ecrfStatusEntryCriteria, ecrfStatusTypeId, valueLockdown, done, validated, review, verified);
		return (Long) ecrfStatusEntryCriteria.setProjection(Projections.rowCount()).uniqueResult();
	}

	private final static void applyEcrfStatusTypeCriterions(org.hibernate.Criteria ecrfStatusEntryCriteria, Long ecrfStatusTypeId, Boolean valueLockdown, Boolean done,
			Boolean validated,
			Boolean review, Boolean verified) {
		if (ecrfStatusTypeId != null || valueLockdown != null || done != null || validated != null || review != null || verified != null) {
			org.hibernate.Criteria ecrfStatusTypeCriteria = ecrfStatusEntryCriteria.createCriteria("status");
			if (ecrfStatusTypeId != null) {
				ecrfStatusTypeCriteria.add(Restrictions.idEq(ecrfStatusTypeId.longValue()));
			}
			if (valueLockdown != null) {
				ecrfStatusTypeCriteria.add(Restrictions.eq("valueLockdown", valueLockdown.booleanValue()));
			}
			if (done != null) {
				ecrfStatusTypeCriteria.add(Restrictions.eq("done", done.booleanValue()));
			}
			if (validated != null) {
				ecrfStatusTypeCriteria.add(Restrictions.eq("validated", validated.booleanValue()));
			}
			if (review != null) {
				ecrfStatusTypeCriteria.add(Restrictions.eq("review", review.booleanValue()));
			}
			if (verified != null) {
				ecrfStatusTypeCriteria.add(Restrictions.eq("verified", verified.booleanValue()));
			}
		}
	}

	@Override
	protected long handleGetCount(Long probandListEntryId, Long ecrfId, Long ecrfStatusTypeId, Boolean valueLockdown, Boolean done, Boolean validated,
			Boolean review, Boolean verified)
			throws Exception {
		org.hibernate.Criteria ecrfStatusEntryCriteria = createEcrfStatusEntryCriteria();
		if (probandListEntryId != null) {
			ecrfStatusEntryCriteria.add(Restrictions.eq("listEntry.id", probandListEntryId.longValue()));
		}
		if (ecrfId != null) {
			ecrfStatusEntryCriteria.add(Restrictions.eq("ecrf.id", ecrfId.longValue()));
		}
		applyEcrfStatusTypeCriterions(ecrfStatusEntryCriteria, ecrfStatusTypeId, valueLockdown, done, validated, review, verified);
		return (Long) ecrfStatusEntryCriteria.setProjection(Projections.rowCount()).uniqueResult();
	}

	/**
	 * Retrieves the entity object that is associated with the specified value object
	 * from the object store. If no such entity object exists in the object store,
	 * a new, blank entity is created
	 */
	private ECRFStatusEntry loadECRFStatusEntryFromECRFStatusEntryVO(ECRFStatusEntryVO eCRFStatusEntryVO) {
		ECRFStatusEntry ecrfStatusEntry = this.load(eCRFStatusEntryVO.getId());
		if (ecrfStatusEntry == null) {
			ecrfStatusEntry = ECRFStatusEntry.Factory.newInstance();
		}
		return ecrfStatusEntry;
	}

	@Override
	public ECRFStatusEntryVO toECRFStatusEntryVO(final ECRFStatusEntry entity) {
		return super.toECRFStatusEntryVO(entity);
	}

	@Override
	public void toECRFStatusEntryVO(
			ECRFStatusEntry source,
			ECRFStatusEntryVO target) {
		super.toECRFStatusEntryVO(source, target);
		ECRFStatusType status = source.getStatus();
		ECRF ecrf = source.getEcrf();
		ProbandListEntry listEntry = source.getListEntry();
		Visit visit = source.getVisit();
		User modifiedUser = source.getModifiedUser();
		if (status != null) {
			target.setStatus(this.getECRFStatusTypeDao().toECRFStatusTypeVO(status));
		}
		if (ecrf != null) {
			target.setEcrf(this.getECRFDao().toECRFOutVO(ecrf));
		}
		if (listEntry != null) {
			target.setListEntry(this.getProbandListEntryDao().toProbandListEntryOutVO(listEntry));
		}
		if (visit != null) {
			target.setVisit(this.getVisitDao().toVisitOutVO(visit));
		}
		if (modifiedUser != null) {
			target.setModifiedUser(this.getUserDao().toUserOutVO(modifiedUser));
		}
		target.setValidationStatus(L10nUtil.createEcrfValidationStatusVO(Locales.USER, source.getValidationStatus()));
	}
}